var Isotope={};!function(){"use strict";Isotope.toggleCheckboxGroup=function(e,t){var n=document.id(e).className,a=document.id(e).checked?"checked":"";"tl_checkbox"==n?$$("#"+t+" .tl_checkbox").each(function(e){e.disabled||(e.checked=a)}):"tl_tree_checkbox"==n&&$$("#"+t+" .parent .tl_tree_checkbox").each(function(e){e.disabled||(e.checked=a)}),Backend.getScrollOffset()},Isotope.openModalGroupSelector=function(e){var t=e||{},n=(window.getSize().y-180).toInt();(!t.height||t.height>n)&&(t.height=n);var a=new SimpleModal({width:t.width,btn_ok:Contao.lang.close,draggable:!1,overlayOpacity:.5,onShow:function(){document.body.setStyle("overflow","hidden")},onHide:function(){document.body.setStyle("overflow","auto")}});return a.addButton(Contao.lang.close,"btn",function(){this.hide()}),a.addButton(Contao.lang.apply,"btn primary",function(){for(var e=[],n=null,a=window.frames,o=0;o<a.length;o++)if("simple-modal-iframe"==a[o].name){n=a[o];break}if(null===n)return void alert("Could not find the SimpleModal frame");var i=n.document.getElementById("tl_listing");i||(i=n.document.getElementById("tl_select"));for(var l=i.getElementsByTagName("input"),o=0;o<l.length;o++)l[o].checked&&!l[o].id.match(/^check_all_/)&&(l[o].id.match(/^reset_/)||e.push(l[o].get("value")));new Request.Contao({evalScripts:!1,onRequest:AjaxRequest.displayBox(Contao.lang.loading+" …"),onSuccess:function(e,t){""!=e&&(window.location.href=e)}}).post({action:t.action,value:e[0],redirect:t.redirect,REQUEST_TOKEN:Contao.request_token}),this.hide(),t.trigger&&t.trigger.fireEvent("closeModal")}),a.show({title:t.title,contents:'<iframe src="'+t.url+'" name="simple-modal-iframe" width="100%" height="'+t.height+'" frameborder="0"></iframe>',model:"modal"}),a},Isotope.openModalPageSelector=function(e){var t=e||{},n=(window.getSize().y-180).toInt();(!t.height||t.height>n)&&(t.height=n);var a=new SimpleModal({width:t.width,btn_ok:Contao.lang.close,draggable:!1,overlayOpacity:.5,onShow:function(){document.body.setStyle("overflow","hidden")},onHide:function(){document.body.setStyle("overflow","auto")}});return a.addButton(Contao.lang.close,"btn",function(){this.hide()}),a.addButton(Contao.lang.apply,"btn primary",function(){for(var e=0,n=null,a=window.frames,o=0;o<a.length;o++)if("simple-modal-iframe"==a[o].name){n=a[o];break}if(null===n)return void alert("Could not find the SimpleModal frame");var i=n.document.getElementById("tl_listing");i||(i=n.document.getElementById("tl_select"));for(var l=i.getElementsByTagName("input"),o=0;o<l.length;o++)l[o].checked&&!l[o].id.match(/^check_all_/)&&(l[o].id.match(/^reset_/)||(e=l[o].get("value")));new Request.Contao({evalScripts:!1,onRequest:AjaxRequest.displayBox(Contao.lang.loading+" …"),onSuccess:function(e,t){""!=e&&(window.location.href=e)}}).post({action:t.action,value:e,redirect:t.redirect,REQUEST_TOKEN:Contao.request_token}),this.hide()}),a.show({title:t.title,contents:'<iframe src="'+t.url+'" name="simple-modal-iframe" width="100%" height="'+t.height+'" frameborder="0"></iframe>',model:"modal"}),a},Isotope.addInteractiveHelp=function(){new Tips.Contao("a.tl_tip",{offset:{x:9,y:21},text:function(e){return e.get("longdesc")}})},Isotope.inheritFields=function(e,t){var n=!1;e.each(function(e,a){var o=document.id("ctrl_"+e);if(o){o.removeProperty("required");var i=o.getParent("div").getFirst("h3");if(!i&&o.match(".tl_checkbox_single_container")&&(i=o),!i)return void(n=!0);i.addClass("inherit");var l=document.id("ctrl_inherit").getFirst("input[value="+e+"]");if(l.setStyle("float","right").inject(i),document.id("ctrl_inherit").getFirst("label[for="+l.get("id")+"]").setStyles({"float":"right","padding-right":"5px","font-weight":"normal"}).set("text",t).inject(i),l.addEvent("change",function(e){var t=document.id("ctrl_"+e.target.get("value"));if(t.match(".tl_checkbox_single_container"))t.getFirst("input[type=checkbox]").disabled=e.target.checked;else{t.getPrevious()&&t.getPrevious().hasClass("mce-tinymce")?t.getPrevious().setStyle("display",e.target.checked?"none":null):t.setStyle("display",e.target.checked?"none":null);try{t.getAllNext(":not(script)").setStyle("display",e.target.checked?"none":null)}catch(n){}}}),o.match(".tl_checkbox_single_container"))o.getFirst("input[type=checkbox]").disabled=l.checked;else{o.setStyle("display",l.checked?"none":null);try{o.getAllNext(":not(script)").setStyle("display",l.checked?"none":null)}catch(r){}}}}),n||document.id("ctrl_inherit").getParent("div").setStyle("display","none")},Isotope.makeSelectExtendable=function(){var e={};document.getElements("select.extendable").forEach(function(t){var n=t.value,a=t.getParent("table").id;e[a]=e[a]||[],e[a].push(t),t.grab(new Element("option",{text:"Add …",value:"extendSelect"})).addEvent("change",function(o){if("extendSelect"==t.value){var i=prompt("Please enter the new group name.");""!=i?(a&&e[a]?e[a].forEach(function(e){new Element("option",{text:i,value:i}).inject(e.getLast(),"before")}):new Element("option",{text:i,value:i}).inject(t.getLast(),"before"),t.value=i,n=i):t.value=n,t.fireEvent("change")}else n=t.value})})},Isotope.makeParentViewSortable=function(e){var t=new Scroller(document.getElement("body"),{onChange:function(e,t){this.element.scrollTo(this.element.getScroll().x,t)}}),n=new Sortables(e,{contstrain:!0,opacity:.6,onStart:function(){t.start()},onComplete:function(){t.stop()},onSort:function(e){var t,n,a,o=e.getFirst("div");o&&(o.hasClass("wrapper_start")?((t=e.getPrevious("li"))&&(a=t.getFirst("div"))&&a.removeClass("indent"),(n=e.getNext("li"))&&(a=n.getFirst("div"))&&a.addClass("indent")):o.hasClass("wrapper_stop")?((t=e.getPrevious("li"))&&(a=t.getFirst("div"))&&a.addClass("indent"),(n=e.getNext("li"))&&(a=n.getFirst("div"))&&a.removeClass("indent")):o.hasClass("indent")?(t=e.getPrevious("li"))&&(a=t.getFirst("div"))&&a.hasClass("wrapper_stop")?o.removeClass("indent"):(n=e.getNext("li"))&&(a=n.getFirst("div"))&&a.hasClass("wrapper_start")&&o.removeClass("indent"):(t=e.getPrevious("li"))&&(a=t.getFirst("div"))&&a.hasClass("wrapper_start")?o.addClass("indent"):(n=e.getNext("li"))&&(a=n.getFirst("div"))&&a.hasClass("wrapper_stop")&&o.addClass("indent"))},handle:".drag-handle"});n.active=!1,n.addEvent("start",function(){n.active=!0}),n.addEvent("complete",function(e){if(n.active){var t,a,o,i;e.getPrevious("li")?(t=e.get("id").replace(/li_/,""),a=e.getPrevious("li").get("id").replace(/li_/,""),o=window.location.search.replace(/id=[0-9]*/,"id="+t)+"&act=cut&mode=1&page_id="+a,i=window.location.href.replace(/\?.*$/,""),new Request.Contao({url:i+o,followRedirects:!1}).get()):e.getParent("ul")&&(t=e.get("id").replace(/li_/,""),a=e.getParent("ul").get("id").replace(/ul_/,""),o=window.location.search.replace(/id=[0-9]*/,"id="+t)+"&act=cut&mode=2&page_id="+a,i=window.location.href.replace(/\?.*$/,""),new Request.Contao({url:i+o,followRedirects:!1}).get())}})}}(),Isotope.MediaManager={},function(){"use strict";Isotope.MediaManager.init=function(e,t,n){var a,o,i,l,r,d,c=$("ctrl_"+t),s=[],g={element:document.id(e),request:{endpoint:window.location.href,inputName:t,params:{action:"uploadMediaManager",name:t,REQUEST_TOKEN:Contao.request_token}},failedUploadTextDisplay:{mode:"custom",maxChars:50,responseProperty:"error"},validation:{allowedExtensions:n},callbacks:{onUpload:function(){AjaxRequest.displayBox(Contao.lang.loading+" …")},onComplete:function(e,n,g){if(!g.success)return void AjaxRequest.hideBox();if(g.file&&s.push(g.file),!(this.getInProgress()>0)){for(d={},l=c.getElements('[name^="'+t+'"]'),o=0;o<l.length;o++)a=l[o].get("name").split("["),3==a.length&&(i=a[1].replace("]",""),d[i]||(d[i]={}),r=a[2].replace("]",""),"radio"==l[o].get("type")?(d[i][r]||(d[i][r]=""),l[o].get("checked")&&(d[i][r]=l[o].get("value"))):d[i][r]=l[o].get("value"));new Request.Contao({evalScripts:!1,onSuccess:function(e,t){c.getElement("div").set("html",t.content),t.javascript&&Browser.exec(t.javascript),AjaxRequest.hideBox(),window.fireEvent("ajax_change")}}).post({action:"reloadMediaManager",name:t,value:d,files:s,REQUEST_TOKEN:Contao.request_token}),s=[]}}}};return new qq.FineUploader(g)},Isotope.MediaManager.makeSortable=function(){$$(".tl_mediamanager .sortable").each(function(e){new Sortables(e,{contstrain:!0,opacity:.6,handle:".drag-handle",onComplete:function(){Isotope.MediaManager.resort(e)}})})},Isotope.MediaManager.act=function(e,t,n){var a=document.id(n).getElement("table"),o=a.getFirst("tbody"),i=document.id(e).getParent("tr");o.getChildren();switch(Backend.getScrollOffset(),t){case"up":i.getPrevious()?i.injectBefore(i.getPrevious()):i.injectInside(o);break;case"down":i.getNext()?i.injectAfter(i.getNext()):i.injectBefore(o.getFirst());break;case"delete":i.destroy()}Isotope.MediaManager.resort(o)},Isotope.MediaManager.resort=function(e){var t,n,a,o,i=e.getChildren();for(a=0;a<i.length;a++){for(t=i[a].getElements("[name]"),o=0;o<t.length;o++)t[o].name=t[o].name.replace(/\[[0-9]+\]/g,"["+a+"]"),t[o].id=t[o].id.replace(/_[0-9]+/g,"_"+a);for(n=i[a].getElements("label"),o=0;o<n.length;o++)n[o].set("for",n[o].get("for").replace(/_[0-9]+/g,"_"+a))}}}(),window.addEvent("domready",function(){Isotope.addInteractiveHelp(),Isotope.makeSelectExtendable(),Isotope.MediaManager.makeSortable()}).addEvent("structure",function(){Isotope.addInteractiveHelp()}),window.addEvent("ajax_change",function(){Isotope.addInteractiveHelp(),Isotope.MediaManager.makeSortable()});